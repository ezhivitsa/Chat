define("dataSource",[],function(){function n(e,t){var n=new XMLHttpRequest;n.open("get",e,!0),n.onreadystatechange=function(){if(n.readyState==4){var e=JSON.parse(n.responseText);t&&t(e,n.status)}},n.send()}function r(e,t,n){var r=new XMLHttpRequest,i=JSON.stringify(e);r.open("POST",t,!0),r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("Content-length",i.length),r.setRequestHeader("Connection","close"),r.onreadystatechange=function(){if(xhr.readyState==4){var e=JSON.parse(xhr.responseText);n&&n(e,xhr.status)}},r.send(i)}var e="/",t={user:e+"user",publicMessages:e+"publicMessages"};return{getUserName:function(e){n(t.user,e)},getMessages:function(e,r,i){var s=t.user+"?";e&&(s+="time="+e+"&"),r&&(s+="limit="+r),n(s,i)},publishPublicMessage:function(e,t){r({message:e})}}}),define("helpers",[],function(){return{extend:function(e,t){e=e||{},t=t||{};var n={},r=null;for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}}}),define("elements/userName",["dataSource","helpers"],function(e,t){function n(e){this.defaults={parentSelector:"header",elementSelector:".name a"},this.init(e)}return n.prototype.init=function(e){this.opts=t.extend(e,this.defaults),this.opts.parent=document.querySelector(this.opts.parentSelector),this.opts.element=this.opts.parent.querySelector(this.opts.elementSelector)},n.prototype.appendName=function(){var t=this;e.getUserName(function(e,n){n==200&&(t.opts.element.innerHTML=e.name)})},n}),define("elements/publicMessages",["helpers","dataSource"],function(e,t){function n(){this.defaults={limit:10,isEnd:!1,dateLastMessage:null,wrapperSelector:".messages ul",textareaSelector:"footer textarea",buttonSelector:"footer button",messageTemplate:'<div><span class="author"><a href="$1">$2</a></span><span class="date">$3</span></div><div class="message">$4</div>'},this.init()}return n.prototype.init=function(t){this.opts=e.extend(t,this.defaults),this.wrapper=document.querySelector(this.opts.wrapperSelector),this.textarea=document.querySelector(this.opts.textareaSelector),this.button=document.querySelector(this.opts.buttonSelector)},n.prototype.getOldMessages=function(e){var n=this;n.opts.isEnd||t.getMessages(this.dateLastMessage,this.limit,function(e,t){if(t==200)for(var r=e.messages.length-1;r>=0;r--)n._addMessageOnPage(e.messages[r])})},n.prototype.listenAddMessage=function(){var e=this;this.opts.button.addEventListener("click",function(){var n=e.opts.textarea.value;t.publishPublicMessage(n,this.limit,function(t,n){n==201&&(e._addMessageOnPage(t),e.opts.textarea.value="")})})},n.prototype._addMessageOnPage=function(e){var t=document.createElement("li");t.innerHTML=this.opts.messageTemplate.replace("$1",e.author.id).replace("$2",e.author.name).replace("$3",e.time).replace("$4",e.message),this.wrapper.appendChild(t)},n}),define("elements/privateMessages",[],function(){function e(){}return e}),define("elements/header",["elements/userName","elements/publicMessages","elements/privateMessages"],function(e,t,n){function r(){var r=new e,i=new n;publicMessages=new t,r.appendName()}return r}),define("pages/main",["elements/header"],function(e){function t(){var t=new e}return t}),define("pages/privateMessages",[],function(){function e(){}return e}),define("main",["pages/main","pages/privateMessages"],function(e,t){var n={main:e,"private-messages":t},r=document.querySelector("body"),i=r.className,s=null;for(var o in n){if(i.indexOf(o)+1){s=n[o];break}return}var o=new s}),require.config({deps:["main"]}),define("config",function(){});